const models = require('../models').database1.models
const { convertDurationMinSecToMs, convertKeyToKeyModeInt, getAudioFeatures, convertKeyToKeyMode, convertIntToKey} = require('./library')

async function getSongs(number,category,order) {
    let options = {
        include: [{
            model: models.musician,
            as: "artist"
        }, {
            model: models.musician,
            as: "composers",
            attributes: ["id", "enName"]
        }, {
            model: models.language,
            attributes: ["id","name"]
        }],
    }

    if(number) {
        options.limit = number
    }

    if(category && order) {
        options.order = [
            [category, order]
        ]
    }

    const songs = await models.song.findAll(options)

    return songs.map(song => {
        song.key = convertIntToKey(song.key, 'forward')

        if (song.mode === 1) {
            song.key += 'm'
        }

        return song
    })
}

module.exports = { getSongs }